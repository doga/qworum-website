<!DOCTYPE html>
<html lang="en-GB">
<!-- 
  TODO What are the use cases & requirements for a Qworum service to persist its state? 

  - per user? (Qworum can help this use case by providing user authentication)
  - per caller URL? 
-->

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/en/style.css">

  <title>Qworum specification, version 1</title>

  <style>
    .note-to-editor {
      /* display: none; */
      background-color: red; color: white; padding: 0.2em;
    } 

    h1>.status-notice {
      text-transform: uppercase;
      color: #999;
    }

    h1>.metadata {
      color: #999;
      white-space: pre;
      font-size: small;
    }

    h1>.metadata::before {
      content: "\ALast updated on ";
    }

    h1>.metadata::after {
      content: ".";
    }

    /* h1, h2, h3, h4, h5, h6 { font-transform: capitalise;} */
    /* img {
      height: 400px;
      width: 600px;
    } */

    pre>code {
      white-space: pre;
    }

    #references ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #references ul li {
      padding-bottom: 1em;
    }

    #references ul li .reference {
      font-weight: bold;
      white-space: pre;
    }

    #references ul li .reference::before {
      content: "[";
    }

    #references ul li .reference::after {
      content: "] \A    ";
    }
  </style>

  <!-- highlight.js (code highlighting) -->
  <!-- https://highlightjs.org/download/ -->
  <!-- https://github.com/highlightjs/highlight.js -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body>
  <main>
    <article>
      <header>
        <h1>
          Qworum specification, version 1 
          <!-- 
            All non-breaking changes can be added without changing the version number. 
            Browsers are supposed to be always up to date.
            Opaque runtimes that aren't up to date will raise faults on newly introduced instructions.
          -->
          <span class="status-notice">Draft</span>
          <span class="metadata">2022.06.26. Author: Doğa Armangil. Twitter: @QworumNet</span>
        </h1>
        <h2>Summary</h2>
        <p>Qworum is:</p>
        <ul>
          <li>the world's first distributed Web application technology.</li>
          <li>
            a module system for Web applications, where modules may be located anywhere on the Web.
          </li>
          <li>
            a <a href="https://martinfowler.com/articles/micro-frontends.html" target="_blank">micro-frontend</a>
            platform that works at Web scale.
          </li>
          <li>
            a new type of Web-based API that complements JSON-RPC, XML-RPC, gRPC, SOAP, REST.
            Qworum APIs can interact with the end-user, and calls can consist of more than one request-response pair.
          </li>
          <li>
            the <em>Service Web</em> that complements
            the HTML-based <em>Document Web</em> and
            the RDF-based <em>Semantic Web</em>.
          </li>
          <li>
            an upgrade to the World Wide Web to make it provide better support for Web applications. This is needed
            because the Web was initially conceived as a medium for content, not applications.
          </li>
        </ul>
        <p>Qworum defines:</p>
        <ul>
          <li>a new top-level Web format called <dfn>the Qworum script</dfn>. These contain executable code rather than
            content as HTML does.</li>
          <li>
            an interpreter for Qworum scripts. This client-side software can be implemented by Web browsers natively or
            as a browser extension.
          </li>
          <li>
            a new client-side storage for storing the execution state of each browser tab. This storage can use
            IndexedDB behind the scenes.
          </li>
        </ul>
      </header>

      <nav>
        <h2>Table of Contents</h2>
        <ol>
          <li>
            <a href="#introduction">Introduction</a>
          </li>
          <li>
            <a href="#terminology">Terminology</a>
            <ol>
              <li><a href="#phase">Phase</a></li>
              <li><a href="#single-phase-service-call">Single-Phase Service Call</a></li>
              <li><a href="#multi-phase-service-call">Multi-Phase Service Call</a></li>
              <li><a href="#script">The Qworum Script</a></li>
              <li><a href="#service-composition">Service Composition</a></li>
              <li><a href="#interactive-service">Interactive Service</a></li>
              <li><a href="#execution-state">Execution State</a></li>
              <li><a href="#object">Qworum Object</a></li>
              <li><a href="#class">Qworum Class</a></li>
            </ol>
          </li>

          <li>
            <a href="#instructions">Instructions</a>
            <ol>
              <li><a href="#data"><code>data</code></a></li>
              <li><a href="#call"><code>call</code></a></li>
              <li><a href="#return"><code>return</code></a></li>
              <li><a href="#goto"><code>goto</code></a></li>
              <li><a href="#sequence"><code>sequence</code></a></li>
              <li><a href="#fault"><code>fault</code></a></li>
              <li><a href="#try"><code>try</code></a></li>
            </ol>
          </li>

          <li>
            <a href="#data-values">Data values</a>
            <ol>
              <li><a href="#json"><code>json</code></a></li>
              <li><a href="#semantic"><code>semantic</code></a></li>
              <!-- <li><a href="#domain-specific-data">Domain-Specific Data</a></li> -->
            </ol>
          </li>

          <!-- <li><a href="#7">Implementations</a></li> -->

          <li>
            <a href="#references">References</a>
          </li>
        </ol>
      </nav>

      <section id='introduction'>
        <h2>
          1. Introduction
        </h2>
        <p>
          The World Wide Web <a href="#ref-www">♦︎</a> was initially conceived as a decentralised information system
          consisting of interlinked documents,
          yet its potential as a medium for applications soon became apparent. The ongoing effort that has been
          undertaken by the ICT community since the Web's early days in order to better support Web applications has
          sofar produced various client-side and server-side upgrades to the initial Web, such as JavaScript and
          application servers.
        </p>
        <p>
          Yet there is room for improvement, particularly regarding the decentralisation of the front-ends of Web
          applications. In today's Web, an application is contained within a single Web <dfn>origin</dfn> (example:
          https://example.com) <a href="#ref-origin">♦︎</a>, and frequently even within a single Web page. This limits
          the amount of functionality
          that can be shared amongst application developer teams, and results in considerable duplication of effort.
          (One notable exception to this picture is OAuth-based services which can be called remotely by applications.)
        </p>
        <p>
          Qworum enables new gains in productivity for the software community by making it possible to build Web
          applications that are composed of interactive services ("Qworum services") that are hosted anywhere on the Web
          and that are callable remotely.
        </p>
        <p>
          It is worth noting that Qworum services are of practical use even if the caller of a service has the same
          Web origin as the called service.
          This is because Qworum services can be inserted in any user flow without disrupting it, similarly to functions
          in conventional programming. For example, with Qworum an application no longer needs to pass a return path to
          the login dialog when it requires the end-user to sign in before accessing a restricted page. Again, this is
          similar to conventional programming where a function does not know how the execution proceeds when its own
          execution finishes.
        </p>
        <p>
          As a foretaste, here is how an e-commerce site might call a remote shopping cart service:
        </p>
        <figure>
          <pre><code class="language-xml">
&lt;!-- Qworum script received by the Web browser from an e-commerce site -->
&lt;sequence xmlns="https://qworum.net/ns/v1/instruction/">
  &lt;!-- 1. Show the user's shopping cart-->
  &lt;call object='["@", "shopping cart"]' href="https://shopping-cart.example/view/" />

  &lt;!-- 2. Go back to the e-commerce site -->
  &lt;goto href="/home/" />
&lt;/sequence>
          </code></pre>
          <figcaption>1.1: Example of a Qworum script</figcaption>
        </figure>
      </section>

      <section id="terminology">
        <h2>2. Terminology</h2>
        <section id="phase">
          <h3>2.1. <dfn>Phase</dfn></h3>
          <p>An HTTP(S) <a href="#ref-http">♦︎</a> request-response pair. </p>
          <figure>
            <img src="figures/figure-2.1.svg" alt="Phase">
            <figcaption>2.1.1: Phase</figcaption>
          </figure>
        </section>

        <section id="single-phase-service-call">
          <h3>2.2. <dfn>Single-Phase Service Call</dfn></h3>
          <p>A call to a Web API that consists of a single phase. Calls to Web APIs that conform to conventional
            specifications such as REST <a href="#ref-rest">♦︎</a> or XML-RPC <a href="#ref-xml-rpc">♦︎</a> are always
            single-phase calls.</p>
          <figure>
            <img src="figures/figure-2.2.svg" alt="Single-Phase Service Call">
            <figcaption>2.2.1: Single-Phase Service Call</figcaption>
          </figure>
        </section>

        <section id='multi-phase-service-call'>
          <h3>2.3. <dfn>Multi-Phase Service Call</dfn></h3>
          <p>A call to a Web API that consists of one or more phases. Calls to Web APIs that conform to the Qworum
            specification are multi-phase calls.</p>
          <p>During a multi-phase call, the first request that is sent by the user agent to the server contains 0, 1 or
            more call parameters. The service then returns a response that:</p>
          <ul>
            <li>contains a <dfn>call result</dfn> (in which case the call is a single-phase call), or</li>
            <li>allows the user agent to initiate a second phase for the current call.</li>
          </ul>
          <p>In this manner, each phase of a multi-phase call can choose to return a result or continue the current call
            with another phase.</p>
          <figure>
            <img src="figures/figure-2.3.svg" alt="">
            <figcaption>2.3.1: Example of a Multi-Phase Service Call</figcaption>
          </figure>
          <p>Qworum mandates that each phase of a particular multi-phase call have the same Web origin, otherwise an
            <em>origin</em> <a href="#fault">fault</a> will be raised during run-time.
          </p>
        </section>

        <section id='script'>
          <h3>2.4. <dfn>The Qworum Script</dfn></h3>
          <p>
            Qworum scripts contain instructions that are to be performed by the user agent.
            Qworum scripts are written in XML <a href="#ref-xml">♦︎</a>, and their root element must be an <a
              href="#instructions">instruction</a>.
          </p>
          <p>
            User agents receive Qworum scripts in one of two ways:
          </p>
          <ul>
            <li>
              A call phase can return a Qworum script to the user agent instead of an HTML document. This script takes
              the form of an XML document that has the content type <code>application/xml</code> or
              <code>text/xml</code>.
            </li>
            <li>
              Qworum scripts can be generated on the client side (in the user agent) by running a JavaScript code. This
              is equivalent to the user agent receiving a Qworum script from the URL of the HTML page that has generated
              the script.
              Client-side script generation is well-suited for Jamstack <a href="#ref-jamstack">♦︎</a> applications and
              services.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
  &lt;!-- Script received by the Web browser from an e-commerce site. -->
  &lt;sequence xmlns="https://qworum.net/ns/v1/instruction/">

  &nbsp;&nbsp;&lt;!-- Show the user's shopping cart. -->
  &nbsp;&nbsp;&lt;call object='["@", "shopping cart"]' href="https://shopping-cart.example/view/" />

  &nbsp;&nbsp;&lt;!-- Go back to the e-commerce site. -->
  &nbsp;&nbsp;&lt;goto href="/home/" />
  &lt;/sequence>
            </code></pre>
            <figcaption>2.4.1: Example of a Qworum script</figcaption>
          </figure>
        </section>

        <section id='service-composition'>
          <h3>2.5. <dfn>Service Composition</dfn></h3>
          <p>The mechanism by which multi-phase calls perform other nested multi-phase calls during their execution.
            Nested calls are performed between two consecutive phases of the call that initiated the nested call.</p>
          <p>When a call is to perform a nested call, one of its phases returns a <a href="#script">script</a> that
            contains a <a href="#call">call</a> instruction. These nested calls are then performed by the user agent
            between two consecutive phases of the call that initiated the nested call.</p>
          <figure>
            <img src="figures/figure-2.5.svg" alt="">
            <figcaption>2.5.1: Example of a nested service call</figcaption>
          </figure>
        </section>

        <section id='interactive-service'>
          <h3>2.6. Interactive Service</h3>
          <p>
            A multi-phase service that can interact with the end-user through HTML <a href="#ref-html">♦︎</a> pages
            during its execution.
            <!-- When an interactive service send an HTML page as a response, it is effectively using the end-user as a resource that that helps it continue its execution by starting a new phase. We are naming this pattern an <dfn id='end-user-invocation'>end-user invocation</dfn>. -->
          </p>
          <figure>
            <img src="figures/figure-2.6.svg" alt="">
            <figcaption>2.6.1: An interactive service call</figcaption>
          </figure>
          <p>For example, a shopping cart service may provide a method that shows shopping cart contents to the end-user
            by offering this type of interactivity.</p>
        </section>

        <section id='execution-state'>
          <h3>2.7. <dfn>Execution State</dfn></h3>
          <p>
            In Qworum, each Web browser tab has its own execution state, which consists of:
          </p>
          <ul>
            <li>A <dfn id='call-stack'>call stack</dfn> that contains one or more <dfn>call frame</dfn>s. The topmost
              call frame pertains to the call currently being executed; the remaining call frames contain the states of
              calls whose executions are currently suspended. Call frames are used for storing call states in the form
              of <a href="#data">data</a>s (which point to data) and <a href="#object">object</a>s.</li>
            <li>A <dfn id='main-object'>main <a href="#object">object</a></dfn> that is attached to the browser tab. The
              main object is the owner of the first call frame in the call stack.</li>
          </ul>
          <p>A regular browsing session on the World Wide Web can be thought of as a multi-phase service call that
            doesn't use the Qworum-related functionality that the user agent provides (except that browsing different
            Web origins within the same browser tab does not raise an <em>origin</em> <a href="#fault">fault</a>).
            In particular: </p>
          <ul>
            <li>regular Web browsing happens within the bounds of the first call frame in the call stack, and</li>
            <li>the main object remains unused during a regular Web browsing session.</li>
          </ul>
          <figure>
            <img src="figures/figure-2.7.svg" alt="">
            <figcaption>2.7.1: The execution state of a browser tab</figcaption>
          </figure>
        </section>

        <section id='object'>
          <h3>2.8. <dfn>Qworum Object</dfn></h3>
          <p>
            In conventional object-oriented programming, objects are used for storing state that is shared between
            multiple calls to one or more functions, which are the object's methods. Qworum is porting this concept into
            the Web environment in the form of Qworum objects.
          </p>
          <p>A Qworum object, then, is a container for run-time state that is shared between different calls. Qworum
            objects are used for storing
            <a href="#data">data</a>s (which point to data) and other Qworum objects.
          </p>
          <p>Qworum objects are needed for storing the states of services such as shopping carts that must remember
            their contents across different calls incoming from an e-commerce site for example. In the absence of Qworum
            objects, Qworum would only be able to support services where each incoming call is independent from
            one another, which is the case for user authentication services and payment processing services among
            others.
          </p>
          <p>Here is how Qworum objects are used in practice:</p>
          <ul>
            <li>Each multi-phase call has a Qworum object that is the owner of the call. When initiating a call, the
              call's owner object is created by the user agent if it does not already exist in the browser tab's
              execution state.</li>
            <li>Each Qworum object has a Web origin which is determined when the object is first used as the owner of a
              call. All phases of all calls which are owned by a Qworum object must have the object's origin, otherwise
              an <em>origin</em> <a href="#fault">fault</a> will be raised during run-time.</li>
            <li>Qworum objects can be stored in call frames, or as the main object of an execution state.</li>
          </ul>
          <figure>
            <img src="figures/figure-2.8.svg" alt="">
            <figcaption>2.8.1: The Qworum object</figcaption>
          </figure>
        </section>

        <section id='class'>
          <h3>2.9. <dfn>Qworum Class</dfn></h3>
          <!-- 
          BUG ????? Multiple classes per origin is probably incompatible with storing persistent class data on the server or even the client.
          A Qworum class must be able to read/write persistent data based on: 1. the caller application (or service???) as identified by its origin URL, and 2. the end-user's ID. 
          -->
          <p>Qworum does not mandate that all Qworum objects stored in an execution state have different origins. It
            follows that calls to the same URL can be made using different owner objects, even within the same browser
            tab. This is how the concept of Qworum classes emerges; not as a browser feature, but rather as an aid for
            designing Qworum-based applications and services.</p>
          <p>Formally, we can define Qworum objects to be instances of Qworum classes, and also that each Web origin can
            host any number of Qworum classes.</p>
          <figure>
            <img src="figures/figure-2.9.svg" alt="">
            <figcaption>2.9.1: Qworum classes and objects</figcaption>
          </figure>
          <p>Going back to our shopping cart example, we can imagine an e-commerce site that allows its users to create
            several shopping carts on the same shopping cart service, for example one "Home" cart, one "Work" cart and
            one "New year's eve party" cart.</p>
        </section>

      </section>

      <section id='instructions'>
        <h2>3. Instructions</h2>
        <!-- TODO <script type='...'> instruction for non-XML script encodings, such as Ruby-like etc. -->
        <p>
          This section lists the instructions that are available to <a href="#script">Qworum script</a>s.
          When evaluated by the user agent, all instructions will yield a value (which is <a
            href="#data"><code>data</code></a>), except for the <a href="#goto"><code>goto</code></a> and <a
            href="#fault"><code>fault</code></a> instructions.
        </p>
        <p>Qworum instructions that conform to this specification must have the XML namespace <a
            href="#ref-xmlns">♦︎</a>
          <code>https://qworum.net/ns/v1/instruction/</code>.
        </p>
        <p>
          Unless otherwise stated, in the XML code examples below all elements whose tags don't have a prefix have the
          namespace <code>https://qworum.net/ns/v1/instruction/</code>, and all elements whose tags have the prefix
          <code>data</code> have the namespace <code>https://qworum.net/ns/v1/data/</code>.
        </p>

        <section id='data'>
          <h3>3.1. <code>data</code></h3>
          <p>
            The <code>data</code> instruction allows writing to, and reading from, a data container that is stored in an <a href="#execution-state">execution state</a>. The current call has read/write access to data in the following locations:
          </p>
          <ul>
            <li>the current call frame,</li>
            <li>the current call's owner object,</li>
            <li>nested objects contained in the current call's owner object.</li>
          </ul>

          <p>
            The location of the data container that is being accessed is determined by <code>data</code>'s mandatory <code>path</code> attribute. 
            This attribute's value is a JSON-encoded array of strings. In these strings, the leading and trailing whitespace characters are ignored.
          </p>
          <p id='reserved-path-prefixes'>
            Within this array, some strings are treated differently by the user agent:</p>
          <ul>
            <li>any string that starts with <code>@</code> denotes the current call's owner object, and</li>
            <li>strings starting with <code>$</code> or <code>#</code> are reserved and should not be used at this time.
            </li>
          </ul>

          <h4>3.1.1. Reading from a data container</h4>

          <p>Here is an example of reading data from a data container:</p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Read the "shopping cart line items" data that is stored locally in the current call. -->
&lt;data path='["shopping cart line items"]' />
            </code></pre>
            <figcaption>3.1.1.1: Reading data that is stored in the current call</figcaption>
          </figure>

          <p>Another example:</p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Read the "shopping cart line items" data that is stored in the current call's owner object. -->
&lt;data path='["@", "shopping cart line items"]' />
            </code></pre>
            <figcaption>3.1.1.2: Reading data that is stored in the current call's owner object</figcaption>
          </figure>

          <p>And another:</p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Read the "line items" data that is stored in the "shopping cart" object -->
&lt;!-- that is in turn stored in the current call's owner object. -->
&lt;data path='["@", "shopping cart", "line items"]' />
            </code></pre>
            <figcaption>3.1.1.3: Reading data that is stored in the current call's owner object</figcaption>
          </figure>

          <p>
            When trying to read from a data container that is located inside a Qworum object, 
            if the Qworum object does not exist then a
            <code>path</code> <a href="#fault">fault</a> will be raised at run-time.
          </p>

          <p>
            If a data container does not contain a data value (that is, the container has not yet been initialised), then trying to read from it will raise a <code>data</code> <a href="#fault">fault</a>.
          </p>

          <!-- <p>Data that is stored has two types of provenances:</p>
          <ul>
            <li>Service compositions — Service calls receive data as parameters, and they return data as a result.</li>
            <li>Web pages — a Web page belonging to a Qworum service or Qworum application can produce data from user inputs or network requests.</li>
          </ul> -->

          <h4>3.1.2. Writing to a data container</h4>

          <p>When writing to a data container, the <code>data</code> instruction must contain one instruction or data value. Here is an example:</p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Clear the "shopping cart line items" data that is stored locally in the current call. -->
&lt;data path='["shopping cart line items"]'>
  &lt;data:json>[]&lt;/data:json>
&lt;/data>
            </code></pre>
            <figcaption>3.1.2.1: Writing data to a data container</figcaption>
          </figure>

          <p>And another:</p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Write the line items received from the shopping cart service -->
&lt;!-- to the "shopping cart line items" data that is stored in the current call. -->
&lt;data path='["shopping cart line items"]'>
  &lt;call object='["@", "shopping cart"]' href='https://shopping-cart.example/view/' />
&lt;/data>
            </code></pre>
            <figcaption>3.1.2.2: Writing a call result to a data</figcaption>
          </figure>

          <p>
            When trying to write to a data container that is located in a Qworum object, 
            if the Qworum object does not exist then a
            <code>path</code> <a href="#fault">fault</a> will be raised at run-time.
          </p>

        </section>

        <section id="call">
          <h3>3.2. <code>call</code></h3>
          <p>
            The <code>call</code> instruction initiates a <a href="#multi-phase-service-call">multi-phase service
              call</a>. It has two optional attributes:</p>
          <ul>
            <li>
              The <dfn><code>object</code></dfn> attribute specifies the path of the <a href="#object">object</a> that
              owns the call within the <a href="#execution-state">execution state</a>.
              The value of the <code>object</code> attribute is a JSON-encoded array of strings (some string values are
              <a href="#reserved-path-prefixes">reserved</a>). If this attribute is omitted, then the new call's owner
              will be the owner of the current call.
            </li>
            <li>
              The <dfn><code>href</code></dfn> attribute specifies the URL of the call's first phase.
              If this attribute is omitted, then this URL will be the browser tab's current URL.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;call object='["@", "shopping cart"]' href='view/' />
            </code></pre>
            <figcaption>3.2.1: A <code>call</code> instruction that issues a GET request</figcaption>
          </figure>

          <p>
            Some of the <a href="#fault"><code>fault</code></a>s that service calls can raise are <code>origin</code> and <code>path</code>.
          </p>

          <p>
            Service calls can have data parameters and/or object parameters.
          </p>

          <h4>3.2.1. The data parameters of service calls</h4>

          <p>
            Service calls can have named data parameters, each parameter containing one instruction or data.

            If a data parameter contains an instruction, then the instruction will be evaluated before executing the
            call.
          </p>
          <p>
            Data parameters will be will be made available to the new call on the client side as local datas with
            the same names as the data parameters.
          </p>
          <p>
            In addition, the data parameters can be POSTed to the call's first phase so that the data can be processed
            on the server side. Whether the data will indeed be sent to the server side depends on the value of the
            <code>send</code> attribute of the <code>parameters</code> element. If the value is <code>true</code>, then
            the data will be POSTed. If the <code>send</code> attribute is absent or if its value is <code>false</code>,
            then the data will not be sent to the server.
          </p>
          <p>
            In other words, by default the called service is assumed to be a Jamstack <a href="#ref-jamstack">♦︎</a>
            service which does not need to receive the data on the server side.
          </p>

          <figure>
            <pre><code class="language-xml">
&lt;call object='["@","shopping cart"]' href='/add-line-items/index.xml'>
  &lt;!-- Send the data to the server, in addition to making it available on the client. -->
  &lt;parameters send='true'>
    &lt;parameter name='line items'> 
      &lt;data:json>
        [{
          "title"   : "Classic ankle boots",
          "price"   : {"EUR": 29.99},
          "quantity": 1
        }]
      &lt;/data:json>
    &lt;/parameter>
  &lt;/parameters>
&lt;/call>
          </code></pre>
            <figcaption>3.2.1.1: A <code>call</code> instruction that issues a POST request</figcaption>
          </figure>

          <p id="phase-parameters">A <code>call</code> instruction that generates a POST request behaves similarly to an
            HTML form that
            contains an item named <code>qworum-phase-parameters</code>:</p>
          <ul>
            <li>The content type of the request body will be <code>application/x-www-form-urlencoded</code>.</li>
            <li>The value of <code>qworum-phase-parameters</code> will be an XML string that contains the <dfn
                id='phase-parameters'>phase parameters</dfn> document. Note that phase parameters documents have their
              own XML namespace.</li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;parameters 
  xmlns='https://qworum.net/ns/v1/phase-parameters/'
  xmlns:data='https://qworum.net/ns/v1/data/'
>
  &lt;parameter name='line items'> 
    &lt;data:json>
      [{
        "title"   : "Classic ankle boots",
        "price"   : {"EUR": 29.99},
        "quantity": 1
      }]
    &lt;/data:json>
  &lt;/parameter>
&lt;/parameters> <!-- TODO: add objects-paramaters element for passing Qworum objects (but first find a use case !!) -->
          </code></pre>
            <figcaption>3.2.1.2: Example of a phase parameters document that will be encoded in a POST request
            </figcaption>
          </figure>

          <p>
            Even if a service hasn't received its data parameters on the server side during its first phase, the service
            nevertheless has the option of sending any and all of its data to the server side during any of its later
            phases by using the <a href="#goto"> <code>goto</code></a> instruction.
          </p>

          <h4>3.2.2. The object parameters of service calls</h4>
          <p class="note-to-editor">Use cases?</p>
          <p>
            Service calls can receive Qworum objects as parameters. These object parameters will be made available to the new call on the client side as call-local objects that have the same names as the object parameters.
          </p>
          <figure>
            <pre><code class="language-xml">
&lt;call object='["@","shopping cart"]' href='/add-line-items/index.xml'>
  &lt;object-parameters>
    &lt;!-- The caller is making its logger available to the service it is calling. -->
    &lt;object-parameter name='logger' object='["@","logger"]' /> 
  &lt;/parameters>
&lt;/call>
          </code></pre>
            <figcaption>3.2.2.1: A <code>call</code> instruction that contains object parameters</figcaption>
          </figure>

        </section>

        <section id="return">
          <h3>3.3. <code>return</code></h3>
          <p>
            The <code>return</code> instruction returns the current <a href="#multi-phase-service-call">multi-phase
              service call</a>. This instruction must contain one instruction or data element.
          </p>

          <figure>
            <pre><code class="language-xml">
&lt;return>
  &lt;data path='["@","line items"]' />
&lt;/return>
            </code></pre>
            <figcaption>3.3.1: Returning data as a result of the current call</figcaption>
          </figure>

          <p>If the current call is the main call of the current browser tab, then this instruction will terminate the
            tab's execution.</p>
        </section>

        <section id="goto">
          <h3>3.4. <code>goto</code></h3>
          <p>
            The <code>goto</code> instruction starts a new phase for the current <a
              href="#multi-phase-service-call">multi-phase service call</a>. It has one optional attribute:
          </p>
          <ul>
            <li>
              The <dfn><code>href</code></dfn> attribute specifies the URL of the new phase.
              If this attribute is omitted, then this URL will be the browser tab's current URL.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;goto href='return.xml' />
            </code></pre>
            <figcaption>3.4.1: A <code>goto</code> instruction that issues a GET request</figcaption>
          </figure>

          <p>
            Similarly to <a href="#call"><code>call</code></a> instructions, <code>goto</code> instructions can also
            have named data parameters, each parameter containing one instruction or data. If a data parameter contains
            an instruction, then the instruction will be evaluated before executing the call.
            The behavior of <code>goto</code> differs from <code>call</code> in that <code>goto</code>'s data parameters
            are always sent to the server side.
          </p>

          <p>One situation where <code>goto</code> needs to have data parameters is when the internal state of a Qworum
            object is updated from the server side using new data, as is shown in the next figure.</p>

          <figure>
            <pre><code class="language-xml">
&lt;goto href='add-line-items-to-cart.xml'>
  &lt;parameters> &lt;!-- For goto's parameters element, "send" is not a valid attribute. -->
    &lt;parameter name='line items to add'>
      &lt;data path='["line items to add"]' />
    &lt;/parameter>

    &lt;parameter name='current line items'>
      &lt;data path='["@","line items"]' />
    &lt;/parameter>
  &lt;/parameters>
&lt;/goto>
            </code></pre>
            <figcaption>3.4.2: A <code>goto</code> instruction that issues a POST request</figcaption>
          </figure>

          <p>
            The <code>goto</code> instruction will raise an <code>origin</code> <a
              href="#fault"><code>fault</code></a> if the <a href="#object">object</a> that the current call belongs to
            has a different origin <a href="#ref-origin">♦︎</a> than this <code>goto</code> phase's origin.
            This is because all phases of all service calls belonging to an object must have the same origin URL.
          </p>
        </section>

        <section id="sequence">
          <h3>3.5. <code>sequence</code></h3>
          <p>
            The <code>sequence</code> instruction contains one or more instructions or data elements, each of which is
            evaluated in turn. This instruction will yield the evaluation result of the last instruction/data in the
            sequence.
          </p>

          <figure>
            <pre><code class="language-xml">
&lt;!-- A shopping cart service directs the user to a remote payment processor. -->
&lt;sequence>

  &lt;!-- 1. Call the payment processing service. -->
  &lt;!-- 2. Store the returned transaction details. -->
  &lt;data path='["@","latest transaction"]'>
    &lt;call object='["@","payment service"]' href="https://payment-processor.example/pay/">
      &lt;parameters>
        &lt;parameter name="amount to pay">
          &lt;data:json>
            {
              "amount"  : 98.99,
              "currency": "EUR",
            }
          &lt;/data:json>
        &lt;/parameter>
      &lt;/parameters>
    &lt;/call>
  &lt;/data>

  &lt;!-- 3. Empty the shopping cart, because payment has succeeded (otherwise a fault would have been raised). -->
  &lt;data path='["@","line items"]'>
    &lt;data:json>[]&lt;/data:json>
  &lt;/data>
  
  &lt;!-- 4. Go to the next phase of the current shopping cart method. -->
  &lt;goto href="paid.html" />

&lt;/sequence>
            </code></pre>
            <figcaption>3.5.1: A <code>sequence</code> example</figcaption>
          </figure>

          <p>
            The sequence will not yield a result in the following cases:
          </p>
          <ul>
            <li>the sequence contains a <a href="#goto"><code>goto</code></a>, or</li>
            <li>a <a href="#fault"><code>fault</code></a> is raised when evaluating one of the sequence's instructions,
              or</li>
            <li>the sequence contains a <a href="#fault"><code>fault</code></a> instruction.</li>
          </ul>

        </section>

        <section id="fault">
          <h3>3.6. <code>fault</code></h3> <!-- TODO human-readable i18'ed fault messages, the stack trace -->
          <p>
            In computer programming, exceptions are used for disrupting the normal course of execution, because 
            an exceptional event has occurred which prevents the program to proceed as intended.
          </p>
          <p>
            In Qworum, exceptions are called "faults".
            A fault can be raised either explicitly by a Qworum application or service 
            (that is, the current Qworum script contains a <code>fault</code> instruction which is evaluated), or implicitly by the Qworum runtime.
          </p>
          <p>
            When a fault is raised during the execution of an instruction, the current call is terminated unless it is caught by an enclosing 
            <a href="#try"><code>try</code></a> instruction in the current Qworum script.
            When a fault terminates the current call, the parent call in turn has a chance of catching the fault.
            If none of the calls in the call stack have caught the fault, then this will terminate the Qworum application.
          </p>
          <p>
            <code>fault</code> has one optional attribute:
          </p>
          <ul>
            <li>
              The <dfn><code>type</code></dfn> attribute specifies the type of the raised fault.
              If this attribute is omitted, then the fault type will be <code>service</code>.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;fault type='origin' />
            </code></pre>
            <figcaption>3.6.1: A fault</figcaption>
          </figure>

          <h4>3.6.1. Fault types</h4>

          <p>
            <code>service</code> faults are faults that are raised due to programming errors in Qworum applications and services, or they are faults whose handling is the responsibility of Qworum applications and services.
            This fault type has the following subtypes:</p>
          <ul>
            <li><code>script</code> — The Qworum script has syntax errors.</li>
            <li><code>origin</code> — A phase of a Qworum object does not have the same origin <a href="#ref-origin">♦︎</a> as the Qworum object itself. (The origin of a Qworum object is the origin of the first call that is performed on the Qworum object.)</li>
            <li><code>data</code> — Reading data did not succeed because the data container has not yet been initialised; in this case the data container can be initialised by catching this fault.</li>
            <li><code>path</code> — The path of a data container or a Qworum object could not be resolved, because one of the strings (except the last one) in the path points to a non-existing Qworum object. This could indicate that a Qworum service that should have been called beforehand wasn't (remember that Qworum objects are only created when performing a service call).</li>
            <li>
              <code>service-specific</code> — Used for faults which are specific to a particular Qworum service or application. Subtypes of this type are prefixed with <code>*</code>.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;fault type='* blocked valve' />
            </code></pre>
            <figcaption>3.6.1.1: A service-specific fault</figcaption>
          </figure>

          <p><code>user-agent</code> faults are raised when an unexpected run-time error occurs in the user agent. This
            fault type has the following subtype:</p>
          <ul>
            <li>
              <code>runtime</code> — Implementation error of the Qworum specification by the user agent.
            </li>
          </ul>

        </section>

        <section id="try">
          <h3>3.7. <code>try</code></h3>
          <p>
            The <code>try</code> instruction is used for catching <a href="#fault">fault</a>s that are raised when
            evaluating the instruction it contains (it can also contain a data element, which never raises a fault).
          </p>

          <p>
            The <code>try</code> instruction contains one or more <dfn id="catch">catch</dfn> clauses, each of which
            contains one or more instructions or data elements. Catch clauses have one optional attribute:
          </p>
          <ul>
            <li>
              The <code>faults</code> attribute is a JSON-encoded array of strings that indicate the fault types that
              are caught by the clause.
              If this attribute is omitted or if the <code>faults</code> array is empty, then the clause will catch all
              faults.
            </li>
          </ul>

          <figure>
            <pre><code class="language-xml">
&lt;!-- Yield the value of a data; initialise it if needed. -->
&lt;try>
  &lt;data path='["shopping cart line items"]' />

  &lt;catch faults='["data"]'>
    &lt;!-- Initialise the data. -->
    &lt;data path='["shopping cart line items"]'>
      &lt;data:json>[]&lt;/data:json>
    &lt;/data>
  &lt;/catch>
&lt;/try>
            </code></pre>
            <figcaption>3.7.1: A <code>try</code> instruction used to initialise a data</figcaption>
          </figure>

          <p>
            The <code>try</code> instruction will yield the result of the last instruction or data it evaluates.
          </p>
        </section>

      </section>

      <section id="data-values">
        <h2>4. Data values</h2>
        <!-- WARNING do not allow XML with non-Qworum namespaces as data values, because we want Qworum scripts that have non-XML encodings.  -->
        <p>An XML element represents a data value if:</p>
        <ul>
          <!-- <li>it has no namespace or its namespace is a URL that has a different origin than <code>https://qworum.com</code>, or</li> -->
          <li>its namespace is <code>https://qworum.net/ns/v1/data/</code>, and the XML element conforms to this
            specification.</li> <!-- TODO: Non-Qworum data namespaces. Also the null namespace? -->
        </ul>

        <section id="json">
          <h3>4.1. <code>json</code></h3>
          <p>Represents JSON-encoded data <a href="#ref-turtle">♦︎</a>.</p>

          <figure>
            <pre><code class="language-xml">
&lt;data:json>
  {
    "givenName" : "Claude",
    "familyName": "Shannon",
    "birthDate" : "1916-04-30"
  }
&lt;/data:json>
            </code></pre>
            <figcaption>4.1.1: Example of <code>json</code> data</figcaption>
          </figure>
        </section>

        <section id="semantic">
          <h3>4.2. <code>semantic</code></h3>
          <p>
            Represents semantic data, encoded as <dfn>JSON-LD</dfn> <a href="#ref-json-ld">♦︎</a>.
            </li>
          </ul>
          <!-- <p>
            Represents semantic data. This data can be specified in one of the following formats:
          </p>
          <ul>
            <li>
              <dfn>Turtle</dfn> <a href="#ref-turtle">♦︎</a> is the default format. If this format is used, then the
              <code>type</code> attribute must either be omitted or have the value <code>turtle</code>.
            </li>
            <li>
              <dfn>JSON-LD</dfn> <a href="#ref-json-ld">♦︎</a>. If this format is used, then the <code>type</code>
              attribute must have the value <code>json-ld</code>.
            </li>
          </ul> -->

          <!-- <figure>
            <pre><code class="language-xml">
&lt;data:semantic>
  &lt;![CDATA[

    @prefix : &lt;https://schema.org/> .

    &lt;https://www.wikidata.org/wiki/Q92760>
      a           :Person ;
      :givenName  "Claude" ;
      :familyName "Shannon" ;
      :birthDate  "1916-04-30" .

  ]]>
&lt;/data:semantic>
</code></pre>
            <figcaption>4.2.1: Example of semantic data written in Turtle</figcaption>
          </figure> -->

          <figure>
            <pre><code class="language-xml">
&lt;data:semantic><!-- &lt;data:semantic type='json-ld'> -->
  {
    "@context": {
      "@vocab": "https://schema.org/"
    },
    "@id"       : "https://www.wikidata.org/wiki/Q92760",
    "@type"     : "Person",
    "givenName" : "Claude",
    "familyName": "Shannon",
    "birthDate" : "1916-04-30"
  }
&lt;/data:semantic>
</code></pre>
            <figcaption>4.2.1: Example of semantic data written in JSON-LD</figcaption>
            <!-- <figcaption>4.2.2: Example of semantic data written in JSON-LD</figcaption> -->
          </figure>

          <p>
            Semantic data is data that uses the vocabularies that are defined by the <dfn>Semantic Web</dfn> <a
              href="#ref-semanticweb">♦︎</a>.
            In these vocabularies each term has a precise meaning that is understood by any software that understands
            that particular vocabulary.
          </p>
          <p>
            In effect, what the Semantic Web is trying to do is create a <strong>machine-understandable language that is
              understood by all software</strong>.
            Compare that vision with the current situation where data is generally only understood by the software that
            has created it, and if a second application has to use that data, than the second application's author (or a
            third-party data integration provider) first has to decipher the structure and meaning of the data.
          </p>
          <p>Here are a few reasons for using semantic data, both in transit and at rest:</p>
          <ul>
            <li>The "transform" step can be removed from <dfn>ETL</dfn> <a href="#ref-etl">♦︎</a> operations.</li>
            <li>Applications can have access to as much additional information as they need about the data they are
              handling, because semantic data generally contains links to other data on the Web.</li>
            <li>
              AI inference engines can reason about semantic data much more readily than about other types of data such
              as JSON, relational or NoSQL data.
            </li>
            <li>Application developers can write less one-off code for handling data, which this improves productivity.</li>
          </ul>
        </section>

        <!-- <section id="domain-specific-data">
          <h3>4.3. Domain-Specific Data</h3>
          <p>
            Domain specific data is represented by an XML element without namespace or with a namespace that is a URL that has a different origin than <code>https://qworum.com</code>.
          </p>

          <figure>
            <pre><code class="language-xml">
&lt;contacts>
  &lt;contact>
    &lt;name>John Smith&lt;/name>
    &lt;email>john.smith@example.com&lt;/email>
  &lt;/contact>

  &lt;contact>
    &lt;name>Jean Delacretaz&lt;/name>
    &lt;email>jean.delacretaz@example.com&lt;/email>
  &lt;/contact>
&lt;/contacts>
</code></pre>
            <figcaption>4.3.1: Example of domain-specific data</figcaption>
          </figure>
        </section> -->
      </section>

      <section id="references">
        <h2>5. References</h2>
        <ul>
          <li id="ref-etl">
            <span class="reference">ETL</span>
            <a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">
              Extract, transform, load (Wikipedia)
            </a>
          </li>
          <li id="ref-html">
            <span class="reference">HTML</span>
            <a href="https://developer.mozilla.org/en-US/docs/Web/HTML">
              HTML: HyperText Markup Language
            </a>
          </li>
          <li id="ref-http">
            <span class="reference">HTTP</span>
            <a href="https://en.wikipedia.org/wiki/HTTP/3">
              HTTP/3
            </a>
          </li>
          <li id="ref-jamstack">
            <span class="reference">Jamstack</span>
            <a href="https://jamstack.org/">
              Website
            </a>
          </li>
          <li id="ref-json">
            <span class="reference">JSON</span>
            <a href="https://www.json.org/json-en.html">
              Introducing JSON
            </a>
          </li>
          <li id="ref-json-ld">
            <span class="reference">JSON-LD</span>
            <a href="https://www.w3.org/TR/json-ld/">
              JSON-LD 1.1,
              A JSON-based Serialization for Linked Data
            </a>
          </li>
          <li id="ref-origin">
            <span class="reference">Origin</span>
            <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin">
              MDN Documentation
            </a>
          </li>
          <li id="ref-rest">
            <span class="reference">REST</span>
            <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">
              Representational state transfer
            </a>
          </li>
          <!-- <li id="ref-turtle">
            <span class="reference">Turtle</span>
            <a href="https://www.w3.org/TR/turtle/">
              RDF 1.1 Turtle,
              Terse RDF Triple Language
            </a>
          </li> -->
          <li id="ref-semanticweb">
            <span class="reference">Semantic Web</span>
            <a href="https://www.w3.org/standards/semanticweb/">
              Semantic Web (W3C)
            </a>
          </li>
          <li id="ref-www">
            <span class="reference">WWW</span>
            <a href="https://www.w3.org/TR/json-ld/">
              World Wide Web
            </a>
          </li>
          <li id="ref-xml">
            <span class="reference">XML</span>
            <a href="https://www.w3.org/TR/2006/REC-xml11-20060816/">
              Extensible Markup Language (XML) 1.1 (Second Edition)
            </a>
          </li>
          <li id="ref-xmlns">
            <span class="reference">XMLNS</span>
            <a href="https://www.w3.org/TR/xml-names/">
              Namespaces in XML 1.0 (Third Edition)
            </a>
          </li>
          <li id="ref-xml-rpc">
            <span class="reference">XML-RPC</span>
            <a href="https://en.wikipedia.org/wiki/XML-RPC">
              XML-RPC
            </a>
          </li>
        </ul>
      </section>

      <footer>

      </footer>
    </article>
  </main>
  <footer>
    © 2022 Doğa Armangil. Twitter: @QworumNet
  </footer>
</body>

</html>